<div class="container mt-4">
  <h2>持ち物</h2>

  <div class="mb-3 d-flex gap-2">
    <%= link_to "ホームへ戻る", root_path, class: "btn btn-outline-secondary btn-sm" %>
    <%= link_to "ショップ", shop_path, class: "btn btn-outline-warning btn-sm" %>
  </div>

  <% if @user_items.any? %>
    <div class="row">
      <% @user_items.each do |user_item| %>
        <% item = user_item.item %>

        <% disabled =
             user_item.quantity <= 0 ||
             (item.effect_type == "heal_one"  && current_user.hp >= User::MAX_HP) ||
             (item.effect_type == "heal_full" && current_user.hp >= User::MAX_HP) ||
             (item.effect_type == "revive"    && current_user.hp > 0)
        %>

        <% game_over = current_user.hp <= 0 %>

        <div class="col-md-4 mb-4">
          <div class="card text-center">
            <div class="card-body">

              <%= image_tag item.image_name,
                    class: "img-fluid mb-2",
                    style: "max-height: 80px;" %>

              <h5 class="card-title"><%= item.name %></h5>

              <p>
                所持数：<strong><%= user_item.quantity %></strong>
              </p>

              <%# ★ ゲームオーバー中は復活の書のみ表示 %>
              <% if !game_over || item.effect_type == "revive" %>
                <%= button_to "使用",
                      use_item_path(user_item),
                      method: :post,
                      class: "btn btn-success btn-sm",
                      disabled: disabled %>
              <% else %>
                <p class="text-muted small mb-0">
                  復活するまで使用不可
                </p>
              <% end %>

            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <p>まだアイテムを持っていません。</p>
  <% end %>
</div>
